<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>WFP Dashboard Display</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: #000;
    overflow: hidden;
  }

  #frame {
    border: none;
    width: 100%;
    height: 100%;
  }

  #loading {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    background: #000;
    color: #aaa;
    font-family: system-ui, Arial, sans-serif;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  #loading.show { opacity: 0.8; }
  #loading .dots span { animation: blink 1.2s infinite both; }
  #loading .dots span:nth-child(2){ animation-delay:.2s }
  #loading .dots span:nth-child(3){ animation-delay:.4s }
  @keyframes blink {0%,80%,100%{opacity:.2}40%{opacity:1}}
</style>
</head>
<body>
<iframe id="frame"
  sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
  referrerpolicy="no-referrer"
  loading="eager"></iframe>

<div id="loading"><div>
  <div>Loading…</div>
  <div class="dots" style="text-align:center;margin-top:6px">
    <span>•</span><span>•</span><span>•</span>
  </div>
</div></div>

<script>
  const urls = [
    "https://analytics.wfp.org/t/Public/views/TajikistanMarketUpdate_September15-21_2025/TajikistanMarketPriceUpdate?:embed=y&:device=desktop&:toolbar=no&:tabs=no&:showVizHome=no",
    "https://unwfp.maps.arcgis.com/apps/Cascade/index.html?appid=1e262af203064241b087c64a7a399d35",
    "https://analytics.wfp.org/t/Public/views/CCARB-ActivitiesTargetingandMonitoring/CCARB-ActivitiesTargetingandMonitoring?:embed=y&:device=desktop&:toolbar=no&:tabs=no&:showVizHome=no"
  ];

  const ROTATE_MS = 60000; // 60 секунд

  const frame = document.getElementById('frame');
  const loading = document.getElementById('loading');
  let i = 0;

  function showLoader(v){ loading.classList.toggle('show', v); }

  function rotate() {
    showLoader(true);
    const url = urls[i];
    frame.onload = () => showLoader(false);
    frame.src = url;
    i = (i + 1) % urls.length;
  }

  rotate();
  setInterval(rotate, ROTATE_MS);

  // Регистрируем Service Worker для кэша, если есть sw.js в корне
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
</script>
</body>
</html>
